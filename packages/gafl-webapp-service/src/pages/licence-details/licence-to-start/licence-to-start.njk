{% extends "standard-form.njk" %}

{% from "radios/macro.njk" import govukRadios %}
{% from "date-input/macro.njk" import govukDateInput %}
{% set title = 'When would you like your licence to start?' %}

{%
    set errorMap = {
        'licence-to-start': {
            'any.required': { ref: '#licence-to-start', text: 'Choose when would you like the licence to start' }
        },
        'licence-start-date': {
            'date.format': { ref: '#licence-start-date-day', text: 'Enter the date you want the licence to start, include a day, month and year' },
            'date.max': { ref: '#licence-start-date-day', text: 'Enter a date within the next ' + data.advancedPurchaseMaxDays + ' days' },
            'date.min': { ref: '#licence-start-date-day', text: 'Enter a date within the next ' + data.advancedPurchaseMaxDays + ' days' }
        }
    }
%}

{% set dateInputItems = [
    {
      name: "day",
      classes: "govuk-input--width-2",
      value: payload['licence-start-date-day']
    },
    {
      name: "month",
      classes: "govuk-input--width-2",
      value: payload['licence-start-date-month']
    },
    {
      name: "year",
      classes: "govuk-input--width-4",
      value: payload['licence-start-date-year']
    }
  ]
%}

{% set startDate %}
    {% if not data.hasJunior %}
        <p class="govuk-body-m">Enter today's date if you want a 1 or 8 day licence to start later today.</p>
    {% endif %}

    {{ govukDateInput({
      id: "licence-start-date",
      namePrefix: "licence-start-date",
      items: dateInputItems,
      errorMessage: { text: 'Enter a date within the next ' + data.advancedPurchaseMaxDays + ' days' } if error['licence-start-date'],
      hint: {
        text: "Enter a date up to and including " + data.maxStartDate
      }
    }) }}
{% endset -%}

{% block pageContent %}
    <p class="govuk-body-m">Your licence can start today or any day within the next {{ data.advancedPurchaseMaxDays }} days.</p>

    {{ govukRadios({
        idPrefix: "licence-to-start",
        name: "licence-to-start",
        items: [
            {
                text: data.startAfterPaymentMinutes + " minutes after payment",
                value: "after-payment",
                checked: payload['licence-to-start'] === 'after-payment'
            },
            {
                text: "Later",
                value: "another-date",
                checked: payload['licence-to-start'] === 'another-date',
                conditional: {
                    html: startDate
                }
            }
        ],
        errorMessage: { text: 'Choose when you\'d like your licence to start' } if error['licence-to-start']
    }) }}
{% endblock %}
