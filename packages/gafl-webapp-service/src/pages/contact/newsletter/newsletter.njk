{% extends "standard-form.njk" %}
{% from "input/macro.njk" import govukInput %}
{% from "radios/macro.njk" import govukRadios %}

{% set title = 'Would you like to receive our email newsletter?' %}

{% set errorMap = {
       'email': {
            'string.empty': { ref: '#email', text: 'You did not enter your email address' },
            'string.email': { ref: '#email', text: 'You did not enter a valid email address' },
            'string.max': { ref: '#email', text: 'You did not enter a valid email address' }
        }
    }
%}

{% set addEmailHtml %}
    {{ govukInput({
      id: "email",
      name: "email",
      type: "email",
      classes: "govuk-!-width-two-thirds",
      autocomplete: "email",
      value: payload.email,
      errorMessage: { text: 'Enter your email address' } if error['email'],
      label: {
        text: "Email address"
      },
      hint: {
          text: "For example angling@email.com"
      },
      attributes: {
        spellcheck: "false",
        maxlength: "50"
      }
    }) }}
{% endset -%}

{% block pageContent %}
    {{ govukRadios({
      idPrefix: "newsletter",
      name: "newsletter",
      fieldset: {
        legend: {
          text: "Stay up to date with the latest news on angling and fisheries and how we spend your licence money. You can unsubscribe at any time",
          isPageHeading: false,
          classes: "govuk-body-m"
        }
      },
      items: [
        {
          value: "yes",
          text: "Yes",
          checked: payload.newsletter === 'yes',
          conditional: {
            html: addEmailHtml if data.emailEntry
          }
        },
        {
          value: "no",
          text: "No",
          checked: true if not payload else false
        }
      ]
    }) }}
    <input type="hidden" name="email-entry" value="{{ 'yes' if data.emailEntry else 'no' }}">
{% endblock %}


