{% extends "layout.njk" %}

{% from "fieldset/macro.njk" import govukFieldset %}
{% from "button/macro.njk" import govukButton %}
{% from "panel/macro.njk" import govukPanel %}
{% from "table/macro.njk" import govukTable %}

{% set title = 'Licence conditions' %}
{% block pageTitle %}{{ title }} - GOV.UK{% endblock %}

{% set bailiffMessage %}
<p class="govuk-body">If our bailiffs ask to see your licence, you must show them:</p>
    <ol class="class="govuk-list govuk-list--number">
        <li class="govuk-body"><span class="govuk-!-font-weight-bold">Proof of your licence: </span><a class="no-print" href="javascript:void(0);" onclick="printDocument();">print out this page</a><span class="print-area">take this printout with you</span> or make a note of your licence number</li>
        <li class="govuk-body"><span class="govuk-!-font-weight-bold">Proof of your identity: </span>such as your driver's licence or other photo ID</li>
    </ol>
{% endset -%}

{% if data.permission.licenceLength === '1D' %}
    {% set lengthText = '1 day' %}
    {% set licenceLengthMessage %}
        <h2 class="govuk-heading-m">We don't send 1-day licences in the post</h2>
        {{ bailiffMessage | trim | safe }}
    {% endset -%}
{% elseif data.permission.licenceLength === '8D' %}
    {% set lengthText = '8 days' %}
    {% set licenceLengthMessage %}
        <h2 class="govuk-heading-m">We don't send 8-day licences in the post</h2>
        {{ bailiffMessage | trim | safe }}
    {% endset -%}
{% else %}
    {% set lengthText = '12 months' %}
    {% set licenceLengthMessage %}
        {% if data.hasJunior  %}
            <h2 class="govuk-heading-m">We don't send junior licences in the post</h2>
            <p class="govuk-body">If our bailiffs ask to see your licence, you must show them proof of your licence. <a class="no-print" href="javascript:void(0);" onclick="printDocument();">Print out this page</a><span class="print-area">take this printout with you</span> or make a note of your licence number.</p>
        {% else %}
            <h2 class="govuk-heading-m">Want to go fishing before your licence arrives?</h2>
            {{ bailiffMessage | trim | safe }}
        {% endif %}
    {% endset -%}
{% endif %}

{% set licenseDetailsSummaryRows = [] %}
{{ licenseDetailsSummaryRows.push([ { text: 'Name' }, { text: data.permission.licensee.firstName + ' ' + data.permission.licensee.lastName } ]) }}
{{ licenseDetailsSummaryRows.push([ { text: 'Type' }, { text: data.permission.licenceType } ]) }}
{{ licenseDetailsSummaryRows.push([ { text: 'Length' }, { text: lengthText } ]) }}
{% if data.permission.licenceType === data.licenceTypes['trout-and-coarse'] %}
    {{ licenseDetailsSummaryRows.push([{ text: 'Number of rods' }, { text: data.permission.numberOfRods }]) }}
{% endif %}

{% if data.hasJunior and data.disabled %}
    {{ licenseDetailsSummaryRows.push([ { text: 'Concessions' }, { text: 'Junior, Disabled' } ]) }}
{% elseif data.hasJunior %}
    {{ licenseDetailsSummaryRows.push([ { text: 'Concessions' }, { text: 'Junior' } ]) }}
{% elseif data.hasSenior and data.disabled %}
   {{ licenseDetailsSummaryRows.push([ { text: 'Concessions' }, { text: 'Senior, Disabled' } ]) }}
{% elseif data.hasSenior %}
   {{ licenseDetailsSummaryRows.push([ { text: 'Concessions' }, { text: 'Senior' } ]) }}
{% elseif data.disabled %}
   {{ licenseDetailsSummaryRows.push([ { text: 'Concessions' }, { text: 'Disabled' } ]) }}
{% endif %}
{{ licenseDetailsSummaryRows.push([ { text: 'Valid from' }, { text: data.startTimeString } ]) }}
{{ licenseDetailsSummaryRows.push([ { text: 'Expires' }, { text: data.endTimeString } ]) }}

{% block content %}
<div class="govuk-grid-row">
    <div class="govuk-grid-column-full">

        {{ govukPanel({
          titleText: "You've bought your licence" if data.permission.cost !== 0 else "You've successfully ordered your licence",
          html: 'Your fishing licence number is <br><strong>' + data.permission.referenceNumber +
            '</strong></br><span class="panel-white-text govuk-body-m">This licence can only be used by ' + data.permission.licensee.firstName + ' ' + data.permission.licensee.lastName + '</span></br>' +
            '<a class="panel-white-text govuk-body-l no-print" href="' + data.uri.pdf + '">Save licence (PDF)</a>'
        }) }}

        {{ govukTable({
          caption: "Your rod fishing licence",
          captionClasses: "govuk-heading-m",
          firstCellIsHeader: true,
          rows: licenseDetailsSummaryRows,
          classes: "govuk-!-margin-top-8"
        }) }}

        {{ licenceLengthMessage | trim | safe }}

        <div class="govuk-!-margin-top-8 no-print">
            <h2 class="govuk-heading-m">Check the byelaws before you go</h2>
            <p class="govuk-body">You must follow the <a target="_blank" href="https://www.gov.uk/freshwater-rod-fishing-rules">rod fishing rules</a> and <a target="_blank" href="https://www.gov.uk/government/collections/local-fishing-byelaws">local fishing byelaws</a> (pages will open in a new window or tab) when you go fishing. These include the rules on:</p>
            <ul class="govuk-list govuk-list--bullet">
                <li>where you can fish</li>
                <li>when you can fish</li>
                <li>which fish youâ€™re allowed to keep</li>
            </ul>
        </div>

        {% if data.permission.licenceType === data.licenceTypes['salmon-and-sea-trout'] %}
            <div class="govuk-!-margin-top-8">
                <h2 class="govuk-heading-m">Report your yearly catch return</h2>
                <p class="govuk-body no-print">You must by law <span class="no-print"><a target="_blank" href="https://www.gov.uk/catch-return">report a catch return</a> (opens in a new window or tab) </span><span class="print-area">report a catch return</span> of your yearly salmon and sea trout fishing activity in England and Wales, even if you do not catch anything or do not fish.</p>
                <p class="govuk-body print-area">You must by law report a catch return of your yearly salmon and sea trout fishing activity in England and Wales, even if you do not catch anything or do not fish.</p>
            </div>
        {% endif %}

        <div class="govuk-!-margin-top-8 no-print">
            <h2 class="govuk-heading-m">Refunds</h2>
            <p class="govuk-body">In certain circumstances you may be eligible for a refund on a 12-month licence. Please see our <a href="{{ data.uri.refund }}">refund policy</a> for details.</p>
        </div>

        {% if data.permission.cost !== 0 %}
        <div class="govuk-!-margin-top-8 no-print">
            <h2 class="govuk-heading-m">How your licence money gets spent</h2>
            <p class="govuk-body">We use your fishing licence money to:</p>
            <ul class="govuk-list govuk-list--bullet">
                <li>improve angling facilities and fish habitats</li>
                <li>protect fisheries from illegal activity</li>
                <li>prevent the spread of fish diseases and invasive, non-native species</li>
                <li>rear and stock coarse fish to boost natural stocks</li>
                <li>encourage more people to go fishing</li>
            </ul>
            <p class="govuk-body">Read the <a target="_blank" href="https://www.gov.uk/government/publications/environment-agency-annual-fisheries-report">annual fisheries report</a> (opens in a new window or tab) for more detail about how we spend this money.</p>
        </div>
        {% endif %}

        <div class="govuk-!-margin-top-8 no-print">
            <h2 class="govuk-heading-m">Your feedback</h2>
            <p class="govuk-body"><a href="/feedback">Tell us what you think about buying your licence</a> (takes 30 seconds)</p>
        </div>

        {{ govukButton({
            href: data.uri.new,
            attributes: { id: 'continue' },
            text: "By another licence",
            classes: "govuk-!-margin-top-9 no-print"
        }) }}
    </div>
</div>
{% endblock %}

{% block bodyEnd %}
    <script src="/public/javascript/all-min.js"></script>
    <script>window.GOVUKFrontend.initAll()</script>
    <script>function printDocument() {window.print();}</script>
{% endblock %}