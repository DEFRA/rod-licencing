AWSTemplateFormatVersion: '2010-09-09'
Description: Cloudformation template to create infrastructure for the rod licencing digital services (local development only)
Resources:
  TransactionStaging:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: TransactionStaging
      AttributeDefinitions:
        - AttributeName: 'id'
          AttributeType: 'S'
      KeySchema:
        - AttributeName: 'id'
          KeyType: 'HASH'
      TimeToLiveSpecification:
        AttributeName: 'expires'
        Enabled: true

  TransactionStagingHistory:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: TransactionStagingHistory
      AttributeDefinitions:
        - AttributeName: 'id'
          AttributeType: 'S'
      KeySchema:
        - AttributeName: 'id'
          KeyType: 'HASH'
      TimeToLiveSpecification:
        AttributeName: 'expires'
        Enabled: true

  PoclAuditBucket:
    Type: AWS::S3::Bucket
    Properties:
      BucketName: pocl-audit

  FulfilmentAuditBucket:
    Type: AWS::S3::Bucket
    Properties:
      BucketName: fulfilment-audit
# At the time of writing (Mar 2020) there are problems using cloudformation templates to initialise SQS queues (FIFO support)
# SalesQueue:
#    Type: AWS::SQS::Queue
#    Properties:
#      QueueName: SalesQueue.fifo
#      FifoQueue: True
#      ContentBasedDeduplication: True
#      DelaySeconds: 10
#      VisibilityTimeout: 30
#      MessageRetentionPeriod: 1209600 # 14 days
#      RedrivePolicy:
#        deadLetterTargetArn:
#          Fn::GetAtt:
#            - SalesDeadLetterQueue
#            - Arn
#        maxReceiveCount: 5
#  SalesDeadLetterQueue:
#    Type: AWS::SQS::Queue
#    Properties:
#      QueueName: SalesDeadLetterQueue.fifo
#      FifoQueue: True
#      DelaySeconds: 30
#      VisibilityTimeout: 30
#      MessageRetentionPeriod: 1209600 # 14 days
